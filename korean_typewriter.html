<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한영 타자기</title>
    <!-- Hangul.js 라이브러리 CDN 로드 -->
    <script src="https://unpkg.com/hangul-js"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            text-align: center;
            margin-top: 30px;
            background-color: #edf7ed;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #28a745;
            margin-bottom: 20px;
        }
        .info {
            background-color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: left;
        }
        .info p {
            margin: 5px 0;
            font-size: 1.1em;
            color: #555;
        }
        .mode {
            margin-top: 15px;
            margin-bottom: 25px;
            font-weight: bold;
            font-size: 1.3em;
            color: #007bff;
            padding: 10px 20px;
            background-color: #e6f7ff;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
        }
        .keyboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr)); /* 반응형 그리드 */
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
            max-width: 800px; /* 최대 너비 제한 */
            width: 100%;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .key {
            padding: 12px 5px;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease, transform 0.1s ease;
            user-select: none; /* 텍스트 선택 방지 */
            min-width: 40px; /* 키 최소 너비 */
        }
        .key:active {
            transform: translateY(1px);
        }
        .number { background-color: #f9c74f; } /* 노랑 */
        .row1 { background-color: #90be6d; } /* 초록 */
        .row2 { background-color: #577590; } /* 파랑 */
        .row3 { background-color: #f94144; } /* 빨강 */
        .space-key {
            grid-column: span 3; /* 스페이스바는 넓게 */
            background-color: #be8e70; /* 갈색 */
        }
        .shift-key, .mode-key {
            grid-column: span 1; /* 쉬프트, 모드 키 */
            background-color: #6a0572; /* 보라색 */
            color: white;
            font-size: 0.9em;
        }

        .label-display {
            margin-top: 30px;
            font-size: 2.2em; /* 큰 폰트 크기 */
            border: 2px solid #007bff; /* 파란색 테두리 */
            padding: 15px 20px;
            width: calc(100% - 40px); /* 패딩 고려한 너비 */
            max-width: 600px; /* 최대 너비 제한 */
            min-height: 50px; /* 최소 높이 */
            display: inline-block;
            white-space: pre-wrap; /* 줄 바꿈 허용 */
            overflow-x: auto; /* 내용이 넘치면 스크롤 */
            text-align: left;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            word-break: break-all; /* 긴 단어 강제 줄바꿈 */
        }
        .active {
            background-color: yellow !important;
            transition: background-color 0.1s ease;
        }
        .back-button {
            margin-top: 30px;
            padding: 10px 25px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-decoration: none;
        }
        .back-button:hover {
            background-color: #2c3e50;
            transform: translateY(-2px);
        }

        /* 미디어 쿼리: 모바일 최적화 */
        @media (max-width: 768px) {
            body { margin-top: 20px; }
            .info { padding: 10px 15px; }
            .info p { font-size: 1em; }
            .mode { font-size: 1.1em; margin-bottom: 20px; }
            .keyboard {
                grid-template-columns: repeat(auto-fit, minmax(30px, 1fr));
                gap: 5px;
                padding: 8px;
            }
            .key { padding: 8px 3px; font-size: 0.9em; min-width: 30px; }
            .label-display {
                font-size: 1.5em;
                padding: 10px 15px;
                min-height: 40px;
            }
            .back-button {
                padding: 8px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <h1>한영 타자기</h1>
    <div class="info">
        <p>이름: 최연서</p>
        <p>학번: 2402211</p>
        <p>소속: 한양여자대학교 빅데이터학과</p>
    </div>
    <div class="mode" id="modeDisplay">현재 모드: 한글</div>
    <div class="keyboard" id="keyboard"></div>
    <label class="label-display" id="displayLabel"></label>
    <a href="index.html" class="back-button">홈으로 돌아가기</a>

    <script>
        const keyboard = document.getElementById('keyboard');
        const displayLabel = document.getElementById('displayLabel');
        const modeDisplay = document.getElementById('modeDisplay');

        let isKorean = true; // 시작 시 한글 모드
        let composingBuffer = ''; // Hangul.js 조합을 위한 버퍼

        // 영문 키보드 레이아웃
        const engKeys = [
            { chars: ['1','2','3','4','5','6','7','8','9','0','-','='], cls: 'number' },
            { chars: ['q','w','e','r','t','y','u','i','o','p','[',']','\\'], cls: 'row1' },
            { chars: ['a','s','d','f','g','h','j','k','l',';','\''], cls: 'row2' },
            { chars: ['z','x','c','v','b','n','m',',','.','/'], cls: 'row3' },
        ];

        // 한글 자모 매핑 (두벌식 기준)
        const korMap = {
            'q': 'ㅂ', 'w': 'ㅈ', 'e': 'ㄷ', 'r': 'ㄱ', 't': 'ㅅ', 'y': 'ㅛ', 'u': 'ㅕ', 'i': 'ㅑ', 'o': 'ㅐ', 'p': 'ㅔ',
            'a': 'ㅁ', 's': 'ㄴ', 'd': 'ㅇ', 'f': 'ㄹ', 'g': 'ㅎ', 'h': 'ㅗ', 'j': 'ㅓ', 'k': 'ㅏ', 'l': 'ㅣ',
            'z': 'ㅋ', 'x': 'ㅌ', 'c': 'ㅊ', 'v': 'ㅍ', 'b': 'ㅠ', 'n': 'ㅜ', 'm': 'ㅡ',
            // 쉬프트 + 알파벳
            'Q': 'ㅃ', 'W': 'ㅉ', 'E': 'ㄸ', 'R': 'ㄲ', 'T': 'ㅆ', 'O': 'ㅒ', 'P': 'ㅖ',
        };

        // 특수 키 매핑
        const specialKeys = {
            'backspace': '← Back',
            'enter': 'Enter',
            'shift': 'Shift',
            ' ': 'Space', // 스페이스바를 명시적으로 추가
        };

        function renderKeyboard() {
            keyboard.innerHTML = '';
            const keyRows = [
                ['1','2','3','4','5','6','7','8','9','0','-','=','backspace'],
                ['q','w','e','r','t','y','u','i','o','p','[',']','\\'],
                ['a','s','d','f','g','h','j','k','l',';','\'','enter'],
                ['shift','z','x','c','v','b','n','m',',','.','/','mode-toggle'] // mode-toggle 추가
            ];

            keyRows.forEach(rowChars => {
                rowChars.forEach(char => {
                    const key = document.createElement('div');
                    key.classList.add('key');
                    let displayChar = '';
                    let className = '';

                    // 숫자 키
                    if ('1234567890'.includes(char)) {
                        className = 'number';
                        displayChar = char;
                    }
                    // 일반 영문/한글 키
                    else if (engKeys.flat().map(r => r.chars).flat().includes(char)) {
                        if (char === 'q' || char === 'w' || char === 'e' || char === 'r' || char === 't' || char === 'p' || char === 'o') {
                            className = 'row1';
                        } else if (char === 'a' || char === 's' || char === 'd' || char === 'f' || char === 'g' || char === 'h' || char === 'j' || char === 'k' || char === 'l') {
                            className = 'row2';
                        } else if (char === 'z' || char === 'x' || char === 'c' || char === 'v' || char === 'b' || char === 'n' || char === 'm') {
                            className = 'row3';
                        }
                        displayChar = isKorean && korMap[char] ? korMap[char] : char;
                    }
                    // 스페이스바
                    else if (char === ' ') {
                        className = 'space-key';
                        displayChar = 'Space';
                    }
                    // 특수 키
                    else {
                        displayChar = specialKeys[char] || char;
                        if (char === 'space') { className = 'space-key'; }
                        else if (char === 'shift' || char === 'mode-toggle') { className = 'shift-key'; }
                    }

                    key.textContent = displayChar;
                    key.classList.add(className);

                    // 각 키에 클릭 이벤트 리스너 추가
                    key.addEventListener('click', () => {
                        simulateKeyPress(char);
                    });

                    keyboard.appendChild(key);
                });
            });
            // 특수 키 추가 (예: 스페이스바, 백스페이스, 엔터)
            // (이 부분은 위 renderKeyboard() 로직에 통합되었습니다)
            // (만약 다른 레이아웃이 필요하면 이 부분을 수정하세요)

            // Shift, Mode Toggle 버튼은 마지막에 추가하는 것이 좋음
            const shiftKey = document.createElement('div');
            shiftKey.className = 'key shift-key';
            shiftKey.textContent = 'Shift';
            shiftKey.addEventListener('click', () => simulateKeyPress('shift'));
            keyboard.appendChild(shiftKey);

            const spaceKey = document.createElement('div');
            spaceKey.className = 'key space-key';
            spaceKey.textContent = 'Space';
            spaceKey.addEventListener('click', () => simulateKeyPress(' '));
            keyboard.appendChild(spaceKey);

            const modeToggleKey = document.createElement('div');
            modeToggleKey.className = 'key mode-key';
            modeToggleKey.textContent = '한/영';
            modeToggleKey.addEventListener('click', () => {
                isKorean = !isKorean;
                modeDisplay.textContent = `현재 모드: ${isKorean ? '한글' : '영어'}`;
                renderKeyboard(); // 모드 변경 시 키보드 다시 렌더링
                composingBuffer = ''; // 버퍼 초기화
            });
            keyboard.appendChild(modeToggleKey);

            const backspaceKey = document.createElement('div');
            backspaceKey.className = 'key shift-key';
            backspaceKey.textContent = '← Back';
            backspaceKey.addEventListener('click', () => simulateKeyPress('backspace'));
            keyboard.appendChild(backspaceKey);

            const enterKey = document.createElement('div');
            enterKey.className = 'key shift-key';
            enterKey.textContent = 'Enter';
            enterKey.addEventListener('click', () => simulateKeyPress('enter'));
            keyboard.appendChild(enterKey);
        }

        // 실제 키보드 입력 처리
        document.addEventListener('keydown', (e) => {
            const originalKey = e.key;
            let key = originalKey.toLowerCase();

            // Shift 키 처리 (shiftKey 속성 사용)
            if (e.shiftKey && korMap[originalKey.toUpperCase()]) {
                key = originalKey.toUpperCase(); // Shift가 눌렸을 때 대문자 키 사용
            }

            // 키보드 시각적 활성화
            const keys = document.querySelectorAll('.key');
            keys.forEach(k => {
                if (k.textContent.toLowerCase() === key || (korMap[key] && k.textContent === korMap[key])) {
                    k.classList.add('active');
                    setTimeout(() => k.classList.remove('active'), 100);
                }
            });

            simulateKeyPress(key);
        });

        function simulateKeyPress(key) {
            if (key === 'hangulmode' || key === '한/영') { // 한영 전환 버튼 클릭
                isKorean = !isKorean;
                modeDisplay.textContent = `현재 모드: ${isKorean ? '한글' : '영어'}`;
                renderKeyboard(); // 모드 변경 시 키보드 다시 렌더링
                composingBuffer = ''; // 버퍼 초기화
                return;
            }

            if (key === 'backspace') {
                if (composingBuffer.length > 0) {
                    composingBuffer = composingBuffer.slice(0, -1); // 조합 중인 문자 버퍼에서 제거
                } else if (displayLabel.textContent.length > 0) {
                    // Hangul.js.disassemble()을 사용하여 마지막 글자 분해 후 제거
                    let lastChar = displayLabel.textContent.slice(-1);
                    let remainingText = displayLabel.textContent.slice(0, -1);
                    if (Hangul.isComplete(lastChar)) { // 완성형 한글인 경우
                         let disassembled = Hangul.disassemble(lastChar);
                         if (disassembled.length > 1) { // 초성 + 중성 + 종성 중 일부만 지울 경우
                            disassembled.pop(); // 마지막 자모 제거
                            composingBuffer = Hangul.assemble(disassembled); // 재조합하여 버퍼에 넣음
                            displayLabel.textContent = remainingText + composingBuffer;
                            composingBuffer = ''; // 조합 완료 후 버퍼 비움
                            return;
                         }
                    }
                    // 일반 문자 또는 조합할 자모가 하나만 남은 경우
                    displayLabel.textContent = remainingText;
                }
                return;
            }

            if (key === 'enter') {
                displayLabel.textContent += '\n'; // 엔터는 줄 바꿈
                composingBuffer = ''; // 버퍼 초기화
                return;
            }

            if (key === 'shift') {
                // Shift 키는 한/영 전환 로직에서 이미 처리됨 (대문자 입력)
                // 가상 키보드에서는 Shift 키가 눌린 상태를 직접 시뮬레이션하기 어려우므로,
                // 실제 키보드의 Shift 작동 방식에 따르도록 합니다.
                // 여기서는 아무것도 하지 않습니다.
                return;
            }

            // 영문 모드일 경우
            if (!isKorean) {
                if (key.length === 1) { // 단일 문자 (숫자, 영어 알파벳, 특수문자 등)
                    displayLabel.textContent += key;
                }
            }
            // 한글 모드일 경우
            else {
                // Hangul.js를 사용하여 한글 조합
                if (korMap[key]) { // 한글 자모 매핑이 있는 경우
                    composingBuffer += korMap[key];
                    displayLabel.textContent = displayLabel.textContent.slice(0, -Hangul.len(composingBuffer.slice(0, -Hangul.len(korMap[key])))) + Hangul.assemble(composingBuffer);
                } else if (key.length === 1) { // 한글 자모가 아닌 일반 문자 (숫자, 영어 등)
                    // 현재 조합 중인 한글이 있다면 먼저 완성
                    if (composingBuffer.length > 0) {
                        displayLabel.textContent += Hangul.assemble(composingBuffer);
                        composingBuffer = ''; // 버퍼 비움
                    }
                    displayLabel.textContent += key;
                }
            }
        }

        // 초기 키보드 렌더링
        document.addEventListener('DOMContentLoaded', () => {
            renderKeyboard();
            modeDisplay.textContent = `현재 모드: ${isKorean ? '한글' : '영어'}`; // 초기 모드 설정
        });

        // 사용자 편의를 위한 초기 안내
        // displayLabel.textContent = "여기에 한글 또는 영어를 입력하세요. '한/영' 버튼 또는 '.' 키로 모드를 전환합니다.";
    </script>
</body>
</html>
